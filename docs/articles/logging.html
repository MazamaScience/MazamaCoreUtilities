<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logging • MazamaCoreUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logging">
<meta property="og:description" content="MazamaCoreUtils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaCoreUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaCoreUtils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="logging_files/header-attrs-2.14/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logging</h1>
                        <h4 class="author">Jonathan Callahan</h4>
            
            <h4 class="date">2018-12-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaCoreUtils/blob/master/vignettes/logging.Rmd"><code>vignettes/logging.Rmd</code></a></small>
      <div class="hidden name"><code>logging.Rmd</code></div>

    </div>

    
    
<div id="logging-in-java-and-python" class="section level1">
<h1 class="hasAnchor">
<a href="#logging-in-java-and-python" class="anchor"></a>Logging in Java and Python</h1>
<p>Operational systems, by definition, need to work without human input.
Systems are considered “operational” after they have been thoroughly
tested and shown to work properly with a variety of input.</p>
<p>However, no software is perfect and no real-world system operates
with 100% availability or 100% consistent input. Things occasionally go
wrong – perhaps intermittently. In a situation with occasional failures
it is vitally important to have good logging information for forensic
analysis.</p>
<p>Other languages used in operational settings support logging at
different levels of information density. The code to write out logs at
these different levels looks very similar in java and python:</p>
<p><strong>java</strong></p>
<pre><code>import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.commons.logging.impl.Jdk14Logger;</code></pre>
<p>… ugly setup of log files …</p>
<pre><code>log.error("ERROR level message");
log.warn("WARN level message");
log.info("INFO level message");
log.debug("DEBUG level message");
log.trace("TRACE level message");</code></pre>
<p><strong>python</strong></p>
<pre><code>import logging
 
logging.basicConfig(filename="my_INFO.log",
                    level=logging.INFO)

logging.error("ERROR level message")
logging.warning("WARNING level message")
logging.info("INFO level message")
logging.debug("DEBUG level message")
logging.trace("TRACE level message")</code></pre>
</div>
<div id="logging-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#logging-in-r" class="anchor"></a>Logging in R</h1>
<p>The <strong>MazamaCoreUtils</strong> package provides functions so
that R logging can look very similar:</p>
<pre><code><a href="https://github.com/MazamaScience/MazamaCoreUtils">library(MazamaCoreUtils)
 
logger.setup(infoLog="my_INFO.log")

logger.error("ERROR level message")
logger.warn("WARN level message")
logger.info("INFO level message")
logger.debug("DEBUG level message")
logger.trace("TRACE level message")</a></code></pre>
<p>This functionality is built on top of the excellent <a href="https://github.com/zatonovo/futile.logger">futile.logger</a>
package.</p>
<div id="log-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#log-levels" class="anchor"></a>Log Levels</h2>
<p>When used properly, logging at different levels lets you create log
files that help you quickly navigate to the specific part of your code
base that generated an error.</p>
<p>Different log levels also allow problems to be dealt with by staff
with different skill levels. Core developers don’t need to be dragged in
whenever anything goes wrong. If a real-time web site is non-responsive,
non-technical staff can be assigned to look at logs to assess the
situation.</p>
<ul>
<li>If the <code>ERROR</code> or <code>WARN</code> logs report that no
data was obtained from an upstream source, the problem is not with the R
code.</li>
<li>If the <code>INFO</code> log reports that incoming data was properly
obtained but that none of it passed QC thresholds, the problem is not
with the R code.</li>
<li>If, however, these logs show everything running smoothly until some
ugly R error message, then it is time to call in the core
developers.</li>
</ul>
<p>Here are our best practices for how to use the different log
levels:</p>
<div id="error" class="section level3">
<h3 class="hasAnchor">
<a href="#error" class="anchor"></a>ERROR</h3>
<p><code>ERROR</code> log statements should only be generated
immediately before a <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code> is issued. The
<code>ERROR.log</code> file should only have entries when R code failed
to complete.</p>
</div>
<div id="warn" class="section level3">
<h3 class="hasAnchor">
<a href="#warn" class="anchor"></a>WARN</h3>
<p><code>WARN</code> log statements imply that something unexpected
happened but that R code is able to complete, perhaps with unpredictable
results. An appropriate use would be after testing the response of an
internet request. R code may be able to trap and handle a failed request
but should comment on the failure in the logs.</p>
</div>
<div id="info" class="section level3">
<h3 class="hasAnchor">
<a href="#info" class="anchor"></a>INFO</h3>
<p><code>INFO</code> log statements are useful for a general overview of
how your R code is proceeding, reflecting top level code structure and
perhaps ending with a final:</p>
<pre><code><a href="../reference/logger.info.html">  logger.info("Successfully completed ...")
  logger.info("\n=============== THE END ===============\n")</a></code></pre>
</div>
<div id="debug" class="section level3">
<h3 class="hasAnchor">
<a href="#debug" class="anchor"></a>DEBUG</h3>
<p><code>DEBUG</code> log statements are best used to map out the path
taken through the code. We recommend including <code>DEBUG</code> level
statements inside of top level loops and beginning each function with
the following:</p>
<pre><code><a href="../reference/logger.debug.html">logger.debug("----- FUNCTION_NAME() -----")</a></code></pre>
</div>
<div id="trace" class="section level3">
<h3 class="hasAnchor">
<a href="#trace" class="anchor"></a>TRACE</h3>
<p><code>TRACE</code> log statements are for the gory details of any
part of your code where you expect or are experiencing errors. These
should contain information about program state and are intended only for
developers.</p>
</div>
</div>
</div>
<div id="a-logging-example" class="section level1">
<h1 class="hasAnchor">
<a href="#a-logging-example" class="anchor"></a>A Logging Example</h1>
<p>The following minimal example demonstrates the use of logging
statements and their output.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaCoreUtils">MazamaCoreUtils</a></span><span class="op">)</span>

<span class="co"># Set up logging </span>
<span class="va">tmpDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/logger.setup.html">logger.setup</a></span><span class="op">(</span>
  errorLog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpDir</span>,<span class="st">"ERROR.log"</span><span class="op">)</span>,
  infoLog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpDir</span>,<span class="st">"INFO.log"</span><span class="op">)</span>,
  traceLog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpDir</span>,<span class="st">"TRACE.log"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Begin main program</span>
<span class="fu"><a href="../reference/logger.info.html">logger.info</a></span><span class="op">(</span><span class="st">"Begin loggingExample ..."</span><span class="op">)</span>

<span class="co"># Try something that might fail</span>
<span class="va">outputSums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">column</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="../reference/logger.trace.html">logger.trace</a></span><span class="op">(</span><span class="st">"Working on: %s"</span>, <span class="va">column</span><span class="op">)</span>
  
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="op">{</span>
    <span class="va">outputSums</span><span class="op">[[</span><span class="va">column</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Sum of "</span>, <span class="va">column</span>, <span class="st">" = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[[</span><span class="va">column</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span> <span class="st">"try-error"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/logger.warn.html">logger.warn</a></span><span class="op">(</span><span class="st">"Oops: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/stop.html">geterrmessage</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
<span class="op">}</span>
<span class="co">#&gt; Error in Summary.factor(structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,  : </span>
<span class="co">#&gt;   'sum' not meaningful for factors</span>

<span class="co"># Successful completion</span>
<span class="fu"><a href="../reference/logger.error.html">logger.error</a></span><span class="op">(</span><span class="st">"NO ERRORS"</span><span class="op">)</span>
<span class="fu"><a href="../reference/logger.info.html">logger.info</a></span><span class="op">(</span><span class="st">"Successfully completed loggingExample"</span><span class="op">)</span>
<span class="fu"><a href="../reference/logger.info.html">logger.info</a></span><span class="op">(</span><span class="st">"\n=============== THE END ===============\n"</span><span class="op">)</span>

<span class="co"># Check the output</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">outputSums</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ Sepal.Length: chr "Sum of Sepal.Length = 876.5"</span>
<span class="co">#&gt;  $ Sepal.Width : chr "Sum of Sepal.Width = 458.6"</span>
<span class="co">#&gt;  $ Petal.Length: chr "Sum of Petal.Length = 563.7"</span>
<span class="co">#&gt;  $ Petal.Width : chr "Sum of Petal.Width = 179.9"</span></code></pre></div>
<p>Here is what is generated in the log files:</p>
<div id="error-log" class="section level2">
<h2 class="hasAnchor">
<a href="#error-log" class="anchor"></a>ERROR.log</h2>
<pre><code>#&gt; ERROR [2022-07-20 11:41:25] NO ERRORS</code></pre>
</div>
<div id="info-log" class="section level2">
<h2 class="hasAnchor">
<a href="#info-log" class="anchor"></a>INFO.log</h2>
<pre><code>#&gt; INFO [2022-07-20 11:41:25] Begin loggingExample ...
#&gt; WARN [2022-07-20 11:41:25] Oops: object 'flog.appender' not found
#&gt; ERROR [2022-07-20 11:41:25] NO ERRORS
#&gt; INFO [2022-07-20 11:41:25] Successfully completed loggingExample
#&gt; INFO [2022-07-20 11:41:25] 
#&gt; =============== THE END ===============</code></pre>
</div>
<div id="trace-log" class="section level2">
<h2 class="hasAnchor">
<a href="#trace-log" class="anchor"></a>TRACE.log</h2>
<pre><code>#&gt; INFO [2022-07-20 11:41:25] Begin loggingExample ...
#&gt; TRACE [2022-07-20 11:41:25] Working on: Sepal.Length
#&gt; TRACE [2022-07-20 11:41:25] Working on: Sepal.Width
#&gt; TRACE [2022-07-20 11:41:25] Working on: Petal.Length
#&gt; TRACE [2022-07-20 11:41:25] Working on: Petal.Width
#&gt; TRACE [2022-07-20 11:41:25] Working on: Species
#&gt; WARN [2022-07-20 11:41:25] Oops: object 'flog.appender' not found
#&gt; ERROR [2022-07-20 11:41:25] NO ERRORS
#&gt; INFO [2022-07-20 11:41:25] Successfully completed loggingExample
#&gt; INFO [2022-07-20 11:41:25] 
#&gt; =============== THE END ===============</code></pre>
</div>
</div>
<div id="extra-functionality" class="section level1">
<h1 class="hasAnchor">
<a href="#extra-functionality" class="anchor"></a>Extra Functionality</h1>
<p>Two more utility functions need to be mentioned</p>
<div id="logger-setlevel" class="section level3">
<h3 class="hasAnchor">
<a href="#logger-setlevel" class="anchor"></a><code>logger.setLevel()</code>
</h3>
<p>This function sets the log level used in the console. By default this
level is set to <code>FATAL</code> which basically means “only when R
crashes”. If you are debugging code interactively you may wish to see
log messages as the are generated by entering the following command:</p>
<pre><code><a href="../reference/logger.setLevel.html">logger.setLevel(TRACE)</a></code></pre>
</div>
<div id="initializelogging" class="section level3">
<h3 class="hasAnchor">
<a href="#initializelogging" class="anchor"></a><code>initializeLogging()</code>
</h3>
<p>This function is a wrapper for our typical usage. It accepts a
<code>logDir</code> parameter and looks for <code>TRACE</code>,
<code>DEBUG</code> <code>INFO</code> and <code>ERROR</code> logs in that
directory. If they are found, they are renamed as
<code><a href="https://rdrr.io/r/base/paste.html">paste0(logLevel,".log.",timestamp)</a></code>. After renaming, new log
files are setup.</p>
<p>This is particularly useful for operational code run inside docker
containers which may be automatically rebooted.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
