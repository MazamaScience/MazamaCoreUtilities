<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logging • MazamaCoreUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logging">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaCoreUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cache-management.html">Cache Managment</a>
    </li>
    <li>
      <a href="../articles/date-parsing.html">Date Parsing</a>
    </li>
    <li>
      <a href="../articles/error-handling.html">Error Handling</a>
    </li>
    <li>
      <a href="../articles/logging.html">Logging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaCoreUtils">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Logging</h1>
                        <h4 class="author">Jonathan Callahan</h4>
            
            <h4 class="date">2018-12-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaCoreUtils/blob/master/vignettes/logging.Rmd"><code>vignettes/logging.Rmd</code></a></small>
      <div class="hidden name"><code>logging.Rmd</code></div>

    </div>

    
    
<div id="logging-in-java-and-python" class="section level1">
<h1 class="hasAnchor">
<a href="#logging-in-java-and-python" class="anchor"></a>Logging in Java and Python</h1>
<p>Operational systems, by definition, need to work without human input. Systems are considered “operational” after they have ben thoroughly tested and shown to work properly with a variety of input.</p>
<p>However, no software is perfect and no real-world system operates with 100% availability or 100% consistent input. Things occasionally go wrong – perhaps intermittently. In a situation with occasional failures it is vitally important to have good logging information for forensic analyis.</p>
<p>Other languages used in operational settings support logging at different levels of information density. The code to write out logs at these different levels looks very similar in java and python:</p>
<p><strong>java</strong></p>
<pre><code>import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.commons.logging.impl.Jdk14Logger;</code></pre>
<p>… ugly setup of log files …</p>
<pre><code>log.error("ERROR level message");
log.warn("WARN level message");
log.info("INFO level message");
log.debug("DEBUG level message");
log.trace("TRACE level message");</code></pre>
<p><strong>python</strong></p>
<pre><code>import logging
 
logging.basicConfig(filename="my_INFO.log",
                    level=logging.INFO)

logging.error("ERROR level message")
logging.warning("WARNING level message")
logging.info("INFO level message")
logging.debug("DEBUG level message")
logging.trace("TRACE level message")</code></pre>
</div>
<div id="logging-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#logging-in-r" class="anchor"></a>Logging in R</h1>
<p>The <strong>MazamaCoreUtils</strong> package provides functions so that R logging can look very similar:</p>
<pre><code><a href="https://www.rdocumentation.org/packages/base/topics/library">library(MazamaCoreUtils)
 
logger.setup(infoLog="my_INFO.log")

logger.error("ERROR level message")
logger.warn("WARN level message")
logger.info("INFO level message")
logger.debug("DEBUG level message")
logger.trace("TRACE level message")</a></code></pre>
<p>This functionality is built on top of the excellent <a href="https://github.com/zatonovo/futile.logger">futile.logger</a> package.</p>
<div id="log-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#log-levels" class="anchor"></a>Log Levels</h2>
<p>When used properly, logging at different levels lets you to create log files that help you quickly navigate to the specific part of your code base that generated an error.</p>
<p>Different log levels also allow problems to be dealt with by staff with different skill levels. Core developers don’t need to be dragged in whenever anything goes wrong. If a real-time web site is non-responsive, non-technical staff can be assigned to look at logs to assess the situation.</p>
<ul>
<li>If the <code>ERROR</code> or <code>WARN</code> logs report that no data was obtained from an upstream source, the problem is not with the R code.</li>
<li>If the <code>INFO</code> log reports that incoming data was properly obtained but that none of it passed QC thresholds, the problem is not with the R code.</li>
<li>If, however, these logs show everything running smoothly until some ugly R error message, then it is time to call in the core developers.</li>
</ul>
<p>Here are our best practices for how to use the different log levels:</p>
<div id="error" class="section level3">
<h3 class="hasAnchor">
<a href="#error" class="anchor"></a>ERROR</h3>
<p><code>ERROR</code> log statements should only be generated immediately before a <code><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop()</a></code> is issued. The <code>ERROR.log</code> file should only have entries when R code failed to complete.</p>
</div>
<div id="warn" class="section level3">
<h3 class="hasAnchor">
<a href="#warn" class="anchor"></a>WARN</h3>
<p><code>WARN</code> log statements imply that something unexpected happend but that R code is able to complete, perhaps with unpredicatble results. An appropriate use would be after testing the response of an internet request. R code may be able to trap and handle a failed request but should comment on the failure in the logs.</p>
</div>
<div id="info" class="section level3">
<h3 class="hasAnchor">
<a href="#info" class="anchor"></a>INFO</h3>
<p><code>INFO</code> log statements are useful for a general overview of how your R code is proceeding, reflecting top level code structure and perhaps ending with a final:</p>
<pre><code><a href="../reference/logger.info.html">  logger.info("Successfully completed ...")
  logger.info("\n=============== THE END ===============\n")</a></code></pre>
</div>
<div id="debug" class="section level3">
<h3 class="hasAnchor">
<a href="#debug" class="anchor"></a>DEBUG</h3>
<p><code>DEBUG</code> log statements are best used to map out the path taken through the code. We recommend including <code>DEBUG</code> level statements inside of top level loops and beginning each function with the following:</p>
<pre><code><a href="../reference/logger.debug.html">logger.debug("----- FUNCTION_NAME() -----")</a></code></pre>
</div>
<div id="trace" class="section level3">
<h3 class="hasAnchor">
<a href="#trace" class="anchor"></a>TRACE</h3>
<p><code>TRACE</code> log statements are for the gory details of any part of your code where you expect or are experiencing errors. These should contain information about program state and are intended only for developers.</p>
</div>
</div>
</div>
<div id="a-logging-example" class="section level1">
<h1 class="hasAnchor">
<a href="#a-logging-example" class="anchor"></a>A Logging Example</h1>
<p>The following minimal example demonstrates the use of logging statements and their output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(MazamaCoreUtils)

<span class="co"># Set up logging </span>
tmpDir &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempdir</a></span>()
<span class="kw"><a href="../reference/logger.setup.html">logger.setup</a></span>(
  <span class="dt">errorLog =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(tmpDir,<span class="st">"ERROR.log"</span>),
  <span class="dt">infoLog =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(tmpDir,<span class="st">"INFO.log"</span>),
  <span class="dt">traceLog =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(tmpDir,<span class="st">"TRACE.log"</span>)
)

<span class="co"># Begin main program</span>
<span class="kw"><a href="../reference/logger.info.html">logger.info</a></span>(<span class="st">"Begin loggingExample ..."</span>)

<span class="co"># Try something that might fail</span>
outputSums &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()
<span class="cf">for</span> ( column <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(iris) ) {
  
  <span class="kw"><a href="../reference/logger.trace.html">logger.trace</a></span>(<span class="st">"Working on: %s"</span>, column)
  
  result &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/try">try</a></span>({
    outputSums[[column]] &lt;-<span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"Sum of "</span>, column, <span class="st">" = "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(iris[[column]]))
  }, <span class="dt">silent =</span> <span class="ot">FALSE</span>)
  
  <span class="cf">if</span> ( <span class="st">"try-error"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(result) ) {
    <span class="kw"><a href="../reference/logger.warn.html">logger.warn</a></span>(<span class="st">"Oops: %s"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">geterrmessage</a></span>())
  }
  
}
<span class="co">#&gt; Error in Summary.factor(structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,  : </span>
<span class="co">#&gt;   'sum' not meaningful for factors</span>

<span class="co"># Successful completion</span>
<span class="kw"><a href="../reference/logger.error.html">logger.error</a></span>(<span class="st">"NO ERRORS"</span>)
<span class="kw"><a href="../reference/logger.info.html">logger.info</a></span>(<span class="st">"Successfully completed loggingExample"</span>)
<span class="kw"><a href="../reference/logger.info.html">logger.info</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=============== THE END ===============</span><span class="ch">\n</span><span class="st">"</span>)

<span class="co"># Check the output</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(outputSums)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ Sepal.Length: chr "Sum of Sepal.Length = 876.5"</span>
<span class="co">#&gt;  $ Sepal.Width : chr "Sum of Sepal.Width = 458.6"</span>
<span class="co">#&gt;  $ Petal.Length: chr "Sum of Petal.Length = 563.7"</span>
<span class="co">#&gt;  $ Petal.Width : chr "Sum of Petal.Width = 179.9"</span></code></pre></div>
<p>Here is what is generated in the log files:</p>
<div id="error-log" class="section level2">
<h2 class="hasAnchor">
<a href="#error-log" class="anchor"></a>ERROR.log</h2>
<pre><code>#&gt; ERROR [2019-08-20 10:51:12] NO ERRORS</code></pre>
</div>
<div id="info-log" class="section level2">
<h2 class="hasAnchor">
<a href="#info-log" class="anchor"></a>INFO.log</h2>
<pre><code>#&gt; INFO [2019-08-20 10:51:12] Begin loggingExample ...
#&gt; WARN [2019-08-20 10:51:12] Oops: object 'flog.logger' not found
#&gt; ERROR [2019-08-20 10:51:12] NO ERRORS
#&gt; INFO [2019-08-20 10:51:12] Successfully completed loggingExample
#&gt; INFO [2019-08-20 10:51:12] 
#&gt; =============== THE END ===============</code></pre>
</div>
<div id="trace-log" class="section level2">
<h2 class="hasAnchor">
<a href="#trace-log" class="anchor"></a>TRACE.log</h2>
<pre><code>#&gt; INFO [2019-08-20 10:51:12] Begin loggingExample ...
#&gt; TRACE [2019-08-20 10:51:12] Working on: Sepal.Length
#&gt; TRACE [2019-08-20 10:51:12] Working on: Sepal.Width
#&gt; TRACE [2019-08-20 10:51:12] Working on: Petal.Length
#&gt; TRACE [2019-08-20 10:51:12] Working on: Petal.Width
#&gt; TRACE [2019-08-20 10:51:12] Working on: Species
#&gt; WARN [2019-08-20 10:51:12] Oops: object 'flog.logger' not found
#&gt; ERROR [2019-08-20 10:51:12] NO ERRORS
#&gt; INFO [2019-08-20 10:51:12] Successfully completed loggingExample
#&gt; INFO [2019-08-20 10:51:12] 
#&gt; =============== THE END ===============</code></pre>
</div>
</div>
<div id="extra-functionality" class="section level1">
<h1 class="hasAnchor">
<a href="#extra-functionality" class="anchor"></a>Extra Functionality</h1>
<p>Two more utility functions need to be mentioned</p>
<div id="logger-setlevel" class="section level3">
<h3 class="hasAnchor">
<a href="#logger-setlevel" class="anchor"></a><code><a href="../reference/logger.setLevel.html">logger.setLevel()</a></code>
</h3>
<p>This function sets the log level used in the console. By default this level is set to <code>FATAL</code> which basically means “only when R crashes”. If you are debugging code interactively you may wish to see log messages as the are generated by entering the following command:</p>
<pre><code><a href="../reference/logger.setLevel.html">logger.setLevel(TRACE)</a></code></pre>
</div>
<div id="initializelogging" class="section level3">
<h3 class="hasAnchor">
<a href="#initializelogging" class="anchor"></a><code><a href="../reference/initializeLogging.html">initializeLogging()</a></code>
</h3>
<p>This function is a wrapper for our typical usage. It accepts a <code>logDir</code> parameter and looks for <code>TRACE</code>, <code>DEBUG</code> <code>INFO</code> and <code>ERROR</code> logs in that directory. If they are found, they are renamed as <code><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0(logLevel,".log.",timestamp)</a></code>. After renaming, new log files are setup.</p>
<p>This is particularly useful for operational code run inside docker containers which may be automatically rebooted.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#logging-in-java-and-python">Logging in Java and Python</a></li>
      <li>
<a href="#logging-in-r">Logging in R</a><ul class="nav nav-pills nav-stacked">
<li><a href="#log-levels">Log Levels</a></li>
      </ul>
</li>
      <li>
<a href="#a-logging-example">A Logging Example</a><ul class="nav nav-pills nav-stacked">
<li><a href="#error-log">ERROR.log</a></li>
      <li><a href="#info-log">INFO.log</a></li>
      <li><a href="#trace-log">TRACE.log</a></li>
      </ul>
</li>
      <li><a href="#extra-functionality">Extra Functionality</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Spencer Pease, Thomas Bergamaschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
